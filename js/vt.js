//testing

Vt-api = "2a22f025a48a058cb9b5f416273355fdc26f3406d234cb7c36929c818737035b"
HOST = ""
Vt = {}
Vt.HOST = "https://www.virustotal.com/vtapi/v2/domain/report?apikey="
Vt.DOMAIN = "domain="

// Get the web host name from Chrome Extension 

chrome.tabs.query({ active: true, currentWindow: true }, function (tabs) {
  var tab = tabs[0];
  var url = new URL(tab.url) ; 
  var host = url.hostname ;
})


function Vt_get_data(host){
	$.ajax({
		type : "get" ,
		url : Vt.HOST + Vt-api + Vt.DOMAIN + host , 
		data : res , 
		success: function(res){
			tmp = res ;
		}
	})
	return tmp ;
}


//TODO
function Vt_form_resolutinos(tmp){
	data = tmp.resolutions ; 
	item = document.getElementById("vt_resolutions") ;
	}
}


function Vt_form_subdomains(tmp){
	data = tmp.domain_siblings ;
	item = document.getElementById("vt_subdomain")
	for (var i = 0 ; i < data.length ; i ++){
		Vt_list_subdomains(data[i])
	}

}


function Vt_list_subdomain(url){
	$.ajax({
		type:"get" ,
		url : url ,
		success function(res){
			html = Vt_subdomains_html(url)
			$("#vt_subdomain").append(html)
		},
	})	
}


function Vt_subdomains_html(url){
	return '\
    <div class="column">\
        <div class="title">' + url + 
            '<a target="_blank" style="float: right; "href="' + url +'">\
            //<img style="width: 20px;" src="/assets/images/google.png"></a>' + 
            //'<a target="_blank" style="float: right; "href="https://www.exploit-db.com/search?cve=' + title.slice(4) +'">\
		<img style= "width: 20px" ;  class="linkify icon"></a>
		//<img style="width: 20px;" src="/assets/images/spider-orange.png"></a>' 
        '</div>\
  </div>';
}

function exec(){
	tmp = Vt_get_data() ;

	subs = document.getElementById("vt_subdomains");

	for (var i = 0 ; i < tmp.domain_siblings ; i++){
		vul = data.domain_siblings[i] ;
		Vt_form_subdomains(vul) ;
	}
		
}



$(document).read(function()){
	exec() ;
}

